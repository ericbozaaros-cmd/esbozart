<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <title>Colecciones – ESBOZART</title>

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet"/>

  <!-- Tu CSS compilado -->
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="../index.html">ESBOZART</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navCol"
              aria-controls="navCol" aria-expanded="false" aria-label="Alternar navegación">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navCol">
        <div class="navbar-nav">
          <a class="nav-link" href="../index.html">Inicio</a>
          <a class="nav-link active" aria-current="page" href="./01 colecciones.html">Colecciones</a>
          <a class="nav-link" href="./03 sobre el artista.html">Sobre el artista</a>
          <a class="nav-link" href="./04 contacto.html">Contacto</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <img src="../IMAGENES/002_COLECCIONES/001-BANNER colecciones.jpg" alt="Mujer con pintura en el rostro" class="banner-hero"/>
    <div class="hero-content"><h1>Colecciones</h1></div>
  </section>

  <!-- COLECCIONES (sidebar + contenido) -->
  <section class="collections py-4">
    <div class="container-xxl">
      <div class="row g-4">
        <!-- SIDEBAR FILTROS -->
        <aside class="col-lg-3">
          <div class="filters-panel">
            <h2 class="h6 mb-3">Filtrar por</h2>

            <form id="filtersForm" class="filters__form filters__form--sidebar" autocomplete="off">
              <!-- Categorías -->
              <fieldset class="filters__field filters__checks filters__checks--stack">
                <legend>Categorías</legend>
                <label><input type="checkbox" name="category" value="retratos" checked> Retratos</label>
                <label><input type="checkbox" name="category" value="figura" checked> Figura humana</label>
                <label><input type="checkbox" name="category" value="oscuro" checked> Oscuro</label>
              </fieldset>

              <!-- Tamaño (muestra solo letra) -->
              <fieldset class="filters__field filters__checks filters__checks--stack">
                <legend>Tamaño</legend>
                <label><input type="checkbox" name="size" value="S"> S</label>
                <label><input type="checkbox" name="size" value="M"> M</label>
                <label><input type="checkbox" name="size" value="L"> L</label>
              </fieldset>

              <!-- Soporte -->
              <fieldset class="filters__field filters__checks filters__checks--stack">
                <legend>Soporte</legend>
                <label><input type="checkbox" name="support" value="lienzo" checked> Lienzo</label>
                <label><input type="checkbox" name="support" value="papel" checked> Papel</label>
                <label><input type="checkbox" name="support" value="print" checked> Prints</label>
              </fieldset>

              <!-- Precio -->
              <label class="filters__field filters__field--range">
                <span>Precio (CLP)</span>
                <div class="filters__range">
                  <input type="number" id="fPriceMin" placeholder="Mín" min="0" step="1000">
                  <span class="dash">—</span>
                  <input type="number" id="fPriceMax" placeholder="Máx" min="0" step="1000">
                </div>
              </label>

              <div class="filters__actions">
                <button type="submit" class="btn">Aplicar</button>
                <button type="button" id="btnClear" class="btn btn--light">Limpiar</button>
              </div>
            </form>
          </div>
        </aside>

        <!-- CONTENIDO -->
        <div class="col-lg-9">
          <div class="d-flex justify-content-end align-items-center mb-3 gap-2">
            <label for="fOrder" class="small mb-0">Ordenar por</label>
            <select id="fOrder" class="form-select form-select-sm order-select">
              <option value="date_desc" selected>Fecha: más recientes</option>
              <option value="date_asc">Fecha: más antiguas</option>
              <option value="price_desc">Precio: más alto</option>
              <option value="price_asc">Precio: más bajo</option>
            </select>
          </div>

          <!-- GALERÍA -->
          <div class="gallery" id="gallery">
            <!-- data-status: disponible | vendida -->
            <article class="artwork"
              data-date="2025-09-12" data-price="100000" data-size="S" data-support="papel"
              data-category="retratos" data-status="disponible">
              <img src="https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?w=800&q=80" alt="OBRA 1 – Kuina" class="artwork-img">
              <div class="artwork-info">
                <span class="artwork-status">Disponible</span>
                <h3 class="artwork-title">OBRA 1 – “Kuina”</h3>
                <p class="artwork-meta">Óleo sobre papel · 20×60 cm</p>
                <p class="artwork-price" data-currency="CLP">100.000 CLP</p>
                <a href="#" class="btn artwork-more" data-bs-toggle="modal" data-bs-target="#artModal">Ver más</a>
              </div>
            </article>

            <article class="artwork"
              data-date="2025-08-25" data-price="180000" data-size="M" data-support="lienzo"
              data-category="figura" data-status="vendida">
              <img src="https://images.unsplash.com/photo-1515405295579-ba7b45403062?w=800&q=80" alt="OBRA 2 – Agua" class="artwork-img">
              <div class="artwork-info">
                <span class="artwork-status">Vendida</span>
                <h3 class="artwork-title">OBRA 2 – “Agua”</h3>
                <p class="artwork-meta">Óleo sobre lienzo · 40×90 cm</p>
                <p class="artwork-price" data-currency="CLP">180.000 CLP</p>
                <a href="#" class="btn artwork-more" data-bs-toggle="modal" data-bs-target="#artModal">Ver más</a>
              </div>
            </article>

            <article class="artwork"
              data-date="2025-07-10" data-price="260000" data-size="L" data-support="lienzo"
              data-category="oscuro" data-status="disponible">
              <img src="https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=800&q=80" alt="OBRA 3 – Miradas" class="artwork-img">
              <div class="artwork-info">
                <span class="artwork-status">Disponible</span>
                <h3 class="artwork-title">OBRA 3 – “Miradas”</h3>
                <p class="artwork-meta">Óleo sobre lienzo · 60×120 cm</p>
                <p class="artwork-price" data-currency="CLP">260.000 CLP</p>
                <a href="#" class="btn artwork-more" data-bs-toggle="modal" data-bs-target="#artModal">Ver más</a>
              </div>
            </article>
          </div>

          <!-- Paginación -->
          <nav class="pager" aria-label="Paginación">
            <button class="pager__btn" id="btnPrev" disabled>&laquo; Anterior</button>
            <ul class="pager__list" id="pagerList"></ul>
            <button class="pager__btn" id="btnNext">Siguiente &raquo;</button>
          </nav>
          <p class="pager__summary" id="pagerSummary"></p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA FINAL -->
  <section class="cta" aria-labelledby="cta-title">
    <div class="cta-wrap">
      <h2 id="cta-title">¿Te gustaría ser parte de esta historia?</h2>
      <a href="https://wa.me/56998038652" class="btn">Habla conmigo</a>
    </div>
  </section>

  <!-- MODAL DETALLE DE OBRA -->
  <div class="modal fade" id="artModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg modal-fullscreen-sm-down">
      <div class="modal-content">
        <button type="button" class="btn-close ms-auto me-2 mt-2" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        <div class="modal-body">
          <div class="row g-4 align-items-start">
            <div class="col-12 col-lg-6">
              <img id="mImg" class="img-fluid rounded" alt="Vista ampliada">
            </div>
            <div class="col-12 col-lg-6">
              <h3 id="mTitle" class="mb-2"></h3>
              <p id="mMeta" class="text-muted mb-1"></p>
              <p class="mb-1 d-none" id="mPriceRow"><strong>Precio:</strong> <span id="mPrice"></span></p>
              <p class="mb-1"><strong>Tamaño:</strong> <span id="mSize"></span></p>
              <p class="mb-1"><strong>Soporte:</strong> <span id="mSupport"></span></p>
              <p class="mb-1"><strong>Categoría:</strong> <span id="mCategory"></span></p>
              <p class="mb-3"><strong>Estado:</strong> <span id="mStatus"></span></p>
              <a id="mWhatsapp" class="btn w-100" target="_blank" rel="noopener">Comprar por WhatsApp</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
      <div class="footer-top">
        <div class="brand">ESBOZART</div>
        <nav class="footer-nav" aria-label="Navegación de pie de página">
          <ul>
            <li><a href="../index.html">Inicio</a></li>
            <li><a href="./01 colecciones.html">Colecciones</a></li>
            <li><a href="./03 sobre el artista.html">Nosotros</a></li>
            <li><a href="./04 contacto.html">Contacto</a></li>
          </ul>
        </nav>
      </div>
      <hr class="footer-rule" />
      <div class="footer-bottom">
     <address class="contacto">
          <a href="mailto:es.bozart7@gmail.com">es.bozart7@gmail.com</a><br />
          Santiago, Chile<br />
          Fono: <a href="tel:+56998038652">(569) 9803 8652</a>
        </address>

        <p class="creditos">Diseño web Eric Boza 2025</p>

        <ul class="social">
          <li><a href="https://www.tiktok.com/@es.bozart" aria-label="Tiktok" target="_blank">Tiktok</a></li>
          <li><a href="https://www.instagram.com/es.bozart/" aria-label="Instagram" target="_blank">Instagram</a></li>
        </ul>
        </ul>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS: filtros + paginación + modal + WhatsApp + orden -->
  <script>
  (function(){
    const $gallery = document.getElementById('gallery');
    const $items = Array.from($gallery.querySelectorAll('.artwork'));
    const $form = document.getElementById('filtersForm');

    const $order = document.getElementById('fOrder');
    const $priceMin = document.getElementById('fPriceMin');
    const $priceMax = document.getElementById('fPriceMax');
    const $sizes = Array.from($form.querySelectorAll('input[name="size"]'));
    const $supports = Array.from($form.querySelectorAll('input[name="support"]'));
    const $categories = Array.from($form.querySelectorAll('input[name="category"]'));
    const $btnClear = document.getElementById('btnClear');

    const $btnPrev = document.getElementById('btnPrev');
    const $btnNext = document.getElementById('btnNext');
    const $pagerList = document.getElementById('pagerList');
    const $pagerSummary = document.getElementById('pagerSummary');

    // Modal
    const $mImg = document.getElementById('mImg');
    const $mTitle = document.getElementById('mTitle');
    const $mMeta = document.getElementById('mMeta');
    const $mPrice = document.getElementById('mPrice');
    const $mPriceRow = document.getElementById('mPriceRow');
    const $mSize = document.getElementById('mSize');
    const $mSupport = document.getElementById('mSupport');
    const $mCategory = document.getElementById('mCategory');
    const $mStatus = document.getElementById('mStatus');
    const $mWhatsapp = document.getElementById('mWhatsapp');
    const WA_NUMBER = '56998038652';

    let filtered = [...$items];
    let current = 1;
    let perPage = getPerPage();

    function getPerPage(){
      const w = window.innerWidth;
      if (w <= 520) return 6;
      if (w <= 820) return 8;
      return 12;
    }

    function readCriteria(){
      const order = $order.value;
      const min = $priceMin.value ? parseInt($priceMin.value, 10) : -Infinity;
      const max = $priceMax.value ? parseInt($priceMax.value, 10) : Infinity;
      let sizes = $sizes.filter(c => c.checked).map(c => c.value.toUpperCase());
      const supports = $supports.filter(c => c.checked).map(c => c.value.toLowerCase());
      const categories = $categories.filter(c => c.checked).map(c => c.value.toLowerCase());
      if (sizes.length === 0) sizes = ['S','M','L']; // si no marcas, se considera todo
      return { order, min, max, sizes, supports, categories };
    }

    function applyFilters(){
      const { order, min, max, sizes, supports, categories } = readCriteria();

      filtered = $items.filter(card => {
        const price = parseInt(card.dataset.price, 10) || 0;
        const sizeVal = (card.dataset.size || '').toUpperCase();
        const sup = (card.dataset.support || '').toLowerCase();
        const cat = (card.dataset.category || '').toLowerCase();

        const okPrice = price >= min && price <= max;
        const okSize  = sizes.includes(sizeVal);
        const okSup   = supports.length ? supports.includes(sup) : true;
        const okCat   = categories.length ? categories.includes(cat) : true;
        return okPrice && okSize && okSup && okCat;
      });

      // Orden
      filtered.sort((a, b) => {
        const pa = parseInt(a.dataset.price, 10) || 0;
        const pb = parseInt(b.dataset.price, 10) || 0;
        const da = new Date(a.dataset.date);
        const db = new Date(b.dataset.date);
        switch (order) {
          case 'price_asc':  return pa - pb;
          case 'price_desc': return pb - pa;
          case 'date_asc':   return da - db;
          default:           return db - da; // date_desc
        }
      });

      current = 1;
      perPage = getPerPage();
      render();
    }

    function render(){
      // Estado + visibilidad de precio (tarjetas)
      $items.forEach(card => {
        const status = (card.dataset.status || '').toLowerCase();
        const statusEl = card.querySelector('.artwork-status');
        const priceEl  = card.querySelector('.artwork-price');
        if (statusEl) {
          statusEl.textContent = (status === 'vendida') ? 'Vendida' : 'Disponible';
          statusEl.classList.toggle('is-sold', status === 'vendida');
        }
        if (priceEl) priceEl.style.display = (status === 'vendida') ? 'none' : '';
      });

      // Paginación
      const total = filtered.length;
      const pages = Math.max(1, Math.ceil(total / perPage));
      if (current > pages) current = pages;

      const start = (current - 1) * perPage;
      const end   = start + perPage;
      const pageSlice = filtered.slice(start, end);

      // Oculta todo
      $items.forEach(el => el.style.display = 'none');

      // Reordenar DOM en el orden de pageSlice
      const frag = document.createDocumentFragment();
      pageSlice.forEach(el => {
        el.style.display = '';
        frag.appendChild(el);
      });
      $gallery.appendChild(frag);

      buildPager(pages, total);
    }

    function buildPager(pages, total){
      $btnPrev.disabled = (current === 1);
      $btnNext.disabled = (current === pages);
      $pagerList.innerHTML = '';
      for (let p = 1; p <= pages; p++){
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = p;
        btn.className = 'pager__page' + (p === current ? ' is-active' : '');
        btn.addEventListener('click', () => { current = p; render(); });
        li.appendChild(btn);
        $pagerList.appendChild(li);
      }
      const first = total ? ((current - 1)*perPage + 1) : 0;
      const last  = Math.min(current*perPage, total);
      $pagerSummary.textContent = total
        ? `Página ${current} de ${Math.ceil(total/perPage)} — Mostrando ${first}–${last} de ${total} obras`
        : `Sin resultados con los filtros seleccionados`;
    }

    // Modal + WhatsApp
    $gallery.addEventListener('click', (ev) => {
      const btn = ev.target.closest('.artwork-more');
      if (!btn) return;
      ev.preventDefault();

      const card = btn.closest('.artwork');
      const imgEl = card.querySelector('.artwork-img');
      const titleEl = card.querySelector('.artwork-title');
      const metaEl = card.querySelector('.artwork-meta');
      const priceEl = card.querySelector('.artwork-price');

      const title = titleEl?.textContent?.trim() || 'Obra';
      const meta  = metaEl?.textContent?.trim() || '';
      const priceTxt = priceEl?.textContent?.trim() || '';
      const size = (card.dataset.size || '').toUpperCase();
      const support = (card.dataset.support || '').toLowerCase();
      const category = (card.dataset.category || '').toLowerCase();
      const status = (card.dataset.status || '').toLowerCase();

      $mImg.src = imgEl?.src || '';
      $mImg.alt = title;
      $mTitle.textContent = title;
      $mMeta.textContent = meta;

      if (status === 'vendida') {
        $mPriceRow.classList.add('d-none');
      } else {
        $mPriceRow.classList.remove('d-none');
        $mPrice.textContent = priceTxt;
      }

      $mSize.textContent = size || '—';
      $mSupport.textContent = support || '—';
      $mCategory.textContent = category || '—';
      $mStatus.textContent = (status === 'vendida') ? 'Vendida' : 'Disponible';

      const cleanTitle = title.replace(/\s+/g, ' ').trim();
      const cleanPrice = (card.dataset.price || '').toString();
      const msg = `Hola, quiero comprar: "${cleanTitle}" - Precio: $${cleanPrice} - Tamaño: ${size} - Categoría: ${category}`;
      const waUrl = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`;

      if (status === 'vendida') {
        $mWhatsapp.classList.add('disabled');
        $mWhatsapp.setAttribute('aria-disabled', 'true');
        $mWhatsapp.removeAttribute('href');
        $mWhatsapp.textContent = 'No disponible';
      } else {
        $mWhatsapp.classList.remove('disabled');
        $mWhatsapp.removeAttribute('aria-disabled');
        $mWhatsapp.href = waUrl;
        $mWhatsapp.textContent = 'Comprar por WhatsApp';
      }
    });

    // Eventos filtros
    $form.addEventListener('submit', (e) => { e.preventDefault(); applyFilters(); });
    $btnClear.addEventListener('click', () => {
      $order.value = 'date_desc';
      $priceMin.value = '';
      $priceMax.value = '';
      [...$sizes, ...$supports, ...$categories].forEach(c => c.checked = false);
      $supports.forEach(c => c.checked = true);
      $categories.forEach(c => c.checked = true);
      applyFilters();
    });

    // IMPORTANTE: reordenar al cambiar el selector "Ordenar por"
    $order.addEventListener('change', applyFilters);

    $btnPrev.addEventListener('click', () => { if (current > 1) { current--; render(); } });
    $btnNext.addEventListener('click', () => { current++; render(); });

    window.addEventListener('resize', () => {
      const newPer = getPerPage();
      if (newPer !== perPage){ perPage = newPer; render(); }
    });

    // init
    applyFilters();
  })();
  </script>
</body>
</html>
